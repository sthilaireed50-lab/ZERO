-- AUTO FARM AÃ‰REO - ATAQUE DESDE ALTURA
-- Hecho especÃ­ficamente para Delta Executor

local Players = game:GetService("Players")
local Workspace = game:GetService("Workspace")
local RunService = game:GetService("RunService")
local TweenService = game:GetService("TweenService")
local VirtualInput = game:GetService("VirtualInputManager")
local UserInputService = game:GetService("UserInputService")

-- Variables principales
local Player = Players.LocalPlayer
local Character = Player.Character or Player.CharacterAdded:Wait()
local HumanoidRootPart = Character:WaitForChild("HumanoidRootPart")
local Humanoid = Character:WaitForChild("Humanoid")

-- ConfiguraciÃ³n del farm aÃ©reo
local AerialFarm = {
    Enabled = false,
    
    -- Sistema de altura
    FlightHeight = 50,          -- Altura de vuelo sobre NPCs
    OptimalHeight = 30,         -- Altura Ã³ptima para atacar
    MaxHeight = 100,            -- Altura mÃ¡xima
    MinHeight = 20,             -- Altura mÃ­nima
    
    -- Sistema de ataque
    AttackRange = 100,          -- Rango mÃ¡ximo de ataque
    AttackFromAbove = true,     -- Atacar desde arriba
    AutoAdjustHeight = true,    -- Ajustar altura automÃ¡ticamente
    
    -- Sistema de movimiento
    HoverSpeed = 2,             -- Velocidad de flotaciÃ³n
    CircleNPCs = true,          -- Circular alrededor de NPCs
    CircleRadius = 15,          -- Radio del cÃ­rculo
    
    -- Sistema de combate
    UseRangedAttacks = true,    -- Usar ataques a distancia
    UseAOEAttacks = true,       -- Usar ataques de Ã¡rea
    AttackPattern = "Vertical", -- PatrÃ³n de ataque
    
    -- Visual
    ShowHeightIndicator = true,
    HeightIndicatorColor = Color3.fromRGB(0, 255, 0)
}

-- Sistema de vuelo aÃ©reo
local FlightThread
local IsFlying = false
local CurrentHeight = AerialFarm.OptimalHeight

-- FunciÃ³n para volar a cierta altura
local function FlyToHeight(targetHeight)
    if not Character or not HumanoidRootPart then return end
    
    local currentPos = HumanoidRootPart.Position
    local targetPos = Vector3.new(currentPos.X, targetHeight, currentPos.Z)
    
    HumanoidRootPart.CFrame = CFrame.new(targetPos)
    CurrentHeight = targetHeight
    
    if AerialFarm.ShowHeightIndicator then
        print("[ALTURA] Volando a: " .. math.floor(targetHeight) .. " studs")
    end
end

-- FunciÃ³n para posicionarse sobre NPC
local function PositionAboveNPC(npc)
    if not npc or not npc:FindFirstChild("HumanoidRootPart") then return end
    
    local npcPos = npc.HumanoidRootPart.Position
    local targetHeight = npcPos.Y + AerialFarm.OptimalHeight
    
    -- Limitar altura mÃ¡xima/mÃ­nima
    targetHeight = math.clamp(
        targetHeight, 
        npcPos.Y + AerialFarm.MinHeight, 
        npcPos.Y + AerialFarm.MaxHeight
    )
    
    -- PosiciÃ³n sobre el NPC
    local targetPos = Vector3.new(
        npcPos.X + (math.random(-5, 5)),  -- PequeÃ±o offset X
        targetHeight,                     -- Altura sobre NPC
        npcPos.Z + (math.random(-5, 5))   -- PequeÃ±o offset Z
    )
    
    -- Teleport a posiciÃ³n
    HumanoidRootPart.CFrame = CFrame.new(targetPos)
    CurrentHeight = targetHeight
    
    return targetPos
end

-- FunciÃ³n para atacar desde arriba
local function AttackFromAbove(npc)
    if not npc or not npc:FindFirstChild("Humanoid") then return end
    
    -- Mirar hacia el NPC
    local npcPos = npc.HumanoidRootPart.Position
    HumanoidRootPart.CFrame = CFrame.new(
        HumanoidRootPart.Position,
        Vector3.new(npcPos.X, HumanoidRootPart.Position.Y - 10, npcPos.Z)
    )
    
    -- Ataques a distancia (simulados)
    if AerialFarm.UseRangedAttacks then
        -- Simular ataque con fruta (habilidades Z, X, C)
        VirtualInput:SendKeyEvent(true, "Z", false, game)
        task.wait(0.1)
        VirtualInput:SendKeyEvent(false, "Z", false, game)
        
        task.wait(0.3)
        
        VirtualInput:SendKeyEvent(true, "X", false, game)
        task.wait(0.1)
        VirtualInput:SendKeyEvent(false, "X", false, game)
        
        task.wait(0.3)
        
        VirtualInput:SendKeyEvent(true, "C", false, game)
        task.wait(0.1)
        VirtualInput:SendKeyEvent(false, "C", false, game)
    end
    
    -- Ataque bÃ¡sico desde arriba
    VirtualInput:SendMouseButtonEvent(0, 0, 0, true, game, 0)
    task.wait(0.05)
    VirtualInput:SendMouseButtonEvent(0, 0, 0, false, game, 0)
end

-- FunciÃ³n para circular alrededor del NPC
local function CircleAroundNPC(npc, radius, height)
    if not npc or not npc:FindFirstChild("HumanoidRootPart") then return end
    
    local npcPos = npc.HumanoidRootPart.Position
    local angle = tick() * AerialFarm.HoverSpeed  -- Ãngulo dinÃ¡mico
    
    -- Calcular posiciÃ³n circular
    local x = npcPos.X + math.cos(angle) * radius
    local z = npcPos.Z + math.sin(angle) * radius
    local y = npcPos.Y + height
    
    -- Mover a posiciÃ³n circular
    HumanoidRootPart.CFrame = CFrame.new(Vector3.new(x, y, z))
    
    -- Mirar hacia el NPC
    HumanoidRootPart.CFrame = CFrame.new(
        Vector3.new(x, y, z),
        Vector3.new(npcPos.X, y, npcPos.Z)
    )
end

-- Buscar NPC mÃ¡s cercano
local function FindNearestNPC()
    local nearest = nil
    local minDistance = math.huge
    
    for _, npc in pairs(Workspace.Enemies:GetChildren()) do
        if npc:FindFirstChild("Humanoid") and npc.Humanoid.Health > 0 then
            if npc:FindFirstChild("HumanoidRootPart") then
                local distance = (HumanoidRootPart.Position - npc.HumanoidRootPart.Position).Magnitude
                if distance < minDistance and distance < AerialFarm.AttackRange then
                    minDistance = distance
                    nearest = npc
                end
            end
        end
    end
    
    -- TambiÃ©n buscar en NPCs normales
    for _, npc in pairs(Workspace.NPCs:GetChildren()) do
        if npc:FindFirstChild("Humanoid") and npc.Humanoid.Health > 0 then
            if npc:FindFirstChild("HumanoidRootPart") then
                local distance = (HumanoidRootPart.Position - npc.HumanoidRootPart.Position).Magnitude
                if distance < minDistance and distance < AerialFarm.AttackRange then
                    minDistance = distance
                    nearest = npc
                end
            end
        end
    end
    
    return nearest, minDistance
end

-- Sistema principal de farm aÃ©reo
local function StartAerialFarm()
    if FlightThread then
        task.cancel(FlightThread)
    end
    
    FlightThread = task.spawn(function()
        IsFlying = true
        
        -- Subir a altura inicial
        FlyToHeight(AerialFarm.FlightHeight)
        
        while AerialFarm.Enabled and IsFlying do
            task.wait(0.5)
            
            pcall(function()
                -- Buscar NPC mÃ¡s cercano
                local npc, distance = FindNearestNPC()
                
                if npc and npc:FindFirstChild("HumanoidRootPart") then
                    local npcPos = npc.HumanoidRootPart.Position
                    
                    -- Calcular altura Ã³ptima basada en distancia
                    local optimalHeight = AerialFarm.OptimalHeight
                    if AerialFarm.AutoAdjustHeight then
                        -- MÃ¡s altura para NPCs lejanos
                        optimalHeight = math.clamp(distance / 2, AerialFarm.MinHeight, AerialFarm.MaxHeight)
                    end
                    
                    if distance < AerialFarm.AttackRange then
                        -- Posicionarse sobre el NPC
                        PositionAboveNPC(npc)
                        
                        -- Atacar desde arriba
                        AttackFromAbove(npc)
                        
                        -- Circular si estÃ¡ configurado
                        if AerialFarm.CircleNPCs and distance < 30 then
                            CircleAroundNPC(npc, AerialFarm.CircleRadius, optimalHeight)
                        end
                    else
                        -- Volar hacia el NPC
                        local targetPos = Vector3.new(
                            npcPos.X,
                            npcPos.Y + optimalHeight,
                            npcPos.Z
                        )
                        
                        HumanoidRootPart.CFrame = CFrame.new(targetPos)
                    end
                    
                    -- Mostrar informaciÃ³n
                    if AerialFarm.ShowHeightIndicator then
                        local heightAboveNPC = HumanoidRootPart.Position.Y - npcPos.Y
                        print(string.format(
                            "[AERIAL] NPC: %s | Distancia: %.1f | Altura: %.1f",
                            npc.Name,
                            distance,
                            heightAboveNPC
                        ))
                    end
                    
                else
                    -- No hay NPCs cerca, mantener altura
                    if AerialFarm.ShowHeightIndicator then
                        print("[AERIAL] Buscando NPCs... Manteniendo altura: " .. math.floor(CurrentHeight))
                    end
                    
                    -- PequeÃ±o movimiento de flotaciÃ³n
                    local currentPos = HumanoidRootPart.Position
                    local floatOffset = math.sin(tick() * 0.5) * 2
                    HumanoidRootPart.CFrame = CFrame.new(
                        Vector3.new(
                            currentPos.X,
                            AerialFarm.FlightHeight + floatOffset,
                            currentPos.Z
                        )
                    )
                end
            end)
        end
    end)
end

-- Sistema de visualizaciÃ³n de altura
local HeightIndicator
local function CreateHeightIndicator()
    if HeightIndicator then
        HeightIndicator:Destroy()
    end
    
    if not AerialFarm.ShowHeightIndicator then return end
    
    HeightIndicator = Instance.new("Part")
    HeightIndicator.Name = "HeightIndicator"
    HeightIndicator.Size = Vector3.new(5, 0.2, 5)
    HeightIndicator.Color = AerialFarm.HeightIndicatorColor
    HeightIndicator.Material = Enum.Material.Neon
    HeightIndicator.Transparency = 0.5
    HeightIndicator.Anchored = true
    HeightIndicator.CanCollide = false
    HeightIndicator.Parent = Workspace
    
    -- Conectar al player
    RunService.Heartbeat:Connect(function()
        if HeightIndicator and HumanoidRootPart then
            local groundPos = HumanoidRootPart.Position
            groundPos = Vector3.new(groundPos.X, 0, groundPos.Z)
            
            HeightIndicator.Position = groundPos
            HeightIndicator.Color = Color3.fromHSV(
                math.clamp(CurrentHeight / 100, 0, 1),
                1,
                1
            )
        end
    end)
end

-- ============================================
-- INTERFAZ DE CONTROL
-- ============================================

local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Parent = game:GetService("CoreGui")

local MainFrame = Instance.new("Frame")
MainFrame.Size = UDim2.new(0, 300, 0, 250)
MainFrame.Position = UDim2.new(0, 10, 0.5, -125)
MainFrame.BackgroundColor3 = Color3.fromRGB(30, 30, 40)
MainFrame.BorderSizePixel = 0
MainFrame.Parent = ScreenGui

local Title = Instance.new("TextLabel")
Title.Size = UDim2.new(1, 0, 0, 40)
Title.BackgroundColor3 = Color3.fromRGB(0, 100, 200)
Title.TextColor3 = Color3.fromRGB(255, 255, 255)
Title.Text = "âœˆï¸ AERIAL FARM SYSTEM"
Title.Font = Enum.Font.GothamBold
Title.TextSize = 16
Title.Parent = MainFrame

-- Controles de altura
local yOffset = 45

local function AddSlider(name, minVal, maxVal, defaultVal, callback)
    local sliderFrame = Instance.new("Frame")
    sliderFrame.Size = UDim2.new(1, -20, 0, 40)
    sliderFrame.Position = UDim2.new(0, 10, 0, yOffset)
    sliderFrame.BackgroundTransparency = 1
    sliderFrame.Parent = MainFrame
    
    local label = Instance.new("TextLabel")
    label.Size = UDim2.new(1, 0, 0, 20)
    label.BackgroundTransparency = 1
    label.TextColor3 = Color3.fromRGB(255, 255, 255)
    label.Text = name .. ": " .. defaultVal
    label.Font = Enum.Font.Gotham
    label.TextSize = 12
    label.TextXAlignment = Enum.TextXAlignment.Left
    label.Parent = sliderFrame
    
    local slider = Instance.new("Frame")
    slider.Size = UDim2.new(1, 0, 0, 10)
    slider.Position = UDim2.new(0, 0, 0, 25)
    slider.BackgroundColor3 = Color3.fromRGB(50, 50, 70)
    slider.BorderSizePixel = 0
    slider.Parent = sliderFrame
    
    local fill = Instance.new("Frame")
    fill.Size = UDim2.new((defaultVal - minVal) / (maxVal - minVal), 0, 1, 0)
    fill.BackgroundColor3 = Color3.fromRGB(0, 200, 255)
    fill.BorderSizePixel = 0
    fill.Parent = slider
    
    -- InteracciÃ³n
    local dragging = false
    slider.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = true
        end
    end)
    
    slider.InputEnded:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = false
        end
    end)
    
    UserInputService.InputChanged:Connect(function(input)
        if dragging and input.UserInputType == Enum.UserInputType.MouseMovement then
            local pos = input.Position
            local relative = slider.AbsolutePosition
            local x = math.clamp(pos.X - relative.X, 0, slider.AbsoluteSize.X)
            local percent = x / slider.AbsoluteSize.X
            local value = math.floor(minVal + (maxVal - minVal) * percent)
            
            fill.Size = UDim2.new(percent, 0, 1, 0)
            label.Text = name .. ": " .. value
            
            if callback then
                callback(value)
            end
        end
    end)
    
    yOffset = yOffset + 45
end

-- BotÃ³n principal
local ToggleButton = Instance.new("TextButton")
ToggleButton.Size = UDim2.new(1, -20, 0, 35)
ToggleButton.Position = UDim2.new(0, 10, 0, yOffset)
ToggleButton.BackgroundColor3 = Color3.fromRGB(255, 50, 50)
ToggleButton.TextColor3 = Color3.fromRGB(255, 255, 255)
ToggleButton.Text = "â¸ï¸ DETENER AUTO FARM AÃ‰REO"
ToggleButton.Font = Enum.Font.GothamBold
ToggleButton.TextSize = 14
ToggleButton.Parent = MainFrame

yOffset = yOffset + 40

-- AÃ±adir sliders
AddSlider("Altura de Vuelo", 20, 150, AerialFarm.FlightHeight, function(value)
    AerialFarm.FlightHeight = value
end)

AddSlider("Altura Ã“ptima", 10, 80, AerialFarm.OptimalHeight, function(value)
    AerialFarm.OptimalHeight = value
end)

AddSlider("Rango de Ataque", 50, 200, AerialFarm.AttackRange, function(value)
    AerialFarm.AttackRange = value
end)

-- BotÃ³n toggle
ToggleButton.MouseButton1Click:Connect(function()
    AerialFarm.Enabled = not AerialFarm.Enabled
    
    if AerialFarm.Enabled then
        ToggleButton.BackgroundColor3 = Color3.fromRGB(50, 200, 50)
        ToggleButton.Text = "âœ… AUTO FARM AÃ‰REO ACTIVADO"
        
        -- Iniciar sistemas
        StartAerialFarm()
        CreateHeightIndicator()
        
        print("========================================")
        print("âœˆï¸ AUTO FARM AÃ‰REO ACTIVADO")
        print("ðŸ“ Altura: " .. AerialFarm.FlightHeight .. " studs")
        print("ðŸŽ¯ Rango: " .. AerialFarm.AttackRange .. " studs")
        print("========================================")
    else
        ToggleButton.BackgroundColor3 = Color3.fromRGB(255, 50, 50)
        ToggleButton.Text = "â¸ï¸ DETENER AUTO FARM AÃ‰REO"
        
        -- Detener sistemas
        IsFlying = false
        if FlightThread then
            task.cancel(FlightThread)
        end
        
        if HeightIndicator then
            HeightIndicator:Destroy()
        end
        
        print("âœˆï¸ AUTO FARM AÃ‰REO DETENIDO")
    end
end)

-- Hotkey para activar/desactivar
UserInputService.InputBegan:Connect(function(input, gameProcessed)
    if input.KeyCode == Enum.KeyCode.F then
        AerialFarm.Enabled = not AerialFarm.Enabled
        
        if AerialFarm.Enabled then
            StartAerialFarm()
            CreateHeightIndicator()
        else
            IsFlying = false
            if FlightThread then
                task.cancel(FlightThread)
            end
        end
    end
end)

-- Ajustar tamaÃ±o del frame
MainFrame.Size = UDim2.new(0, 300, 0, yOffset + 10)

print("========================================")
print("âœˆï¸ SISTEMA DE AUTO FARM AÃ‰REO CARGADO")
print("ðŸŽ® Controles:")
print("â€¢ Click en botÃ³n: Activar/Desactivar")
print("â€¢ Tecla F: Toggle rÃ¡pido")
print("â€¢ Sliders: Ajustar configuraciÃ³n")
print("========================================")
